document.addEventListener("touchstart", function () {
}, true);
document.addEventListener("DOMContentLoaded", () => {
    startPHP(true);
});
function startPHP(firstRun) {
    if (firstRun) {
        document.getElementById("Projects").addEventListener("click", changeActiveNavItemPHP);
        document.getElementById("Skills").addEventListener("click", changeActiveNavItemPHP);
        document.getElementById("Contact").addEventListener("click", changeActiveNavItemPHP);
    }
    let activNavItem = document.getElementsByClassName("nav-item active")[0].children[0].textContent;
    if (activNavItem == "Projects") {
        loadsubSitephp(activNavItem);
        buildCarousel();
        buildSmallProjects();
    }
    else if (activNavItem == "Skills") {
        loadsubSitephp(activNavItem);
    }
    else if (activNavItem == "Contact") {
        loadsubSitephp(activNavItem);
    }
}
// @ts-ignore
/** Changes the active NavItem to the clicked one*/
function changeActiveNavItemPHP(e) {
    //@ts-ignore
    let navItem = e.currentTarget;
    let activNavItem = document.getElementsByClassName("nav-item active");
    if (activNavItem.length <= 1) {
        activNavItem[0].children[0].setAttribute("class", "nav-link");
        activNavItem[0].setAttribute("class", "nav-item");
    }
    navItem.setAttribute("class", "nav-link disabled");
    navItem.parentElement.setAttribute("class", "nav-item active");
    start(false);
}
function loadsubSitephp(name) {
    let api = new Api();
    let callback = (request) => {
        if (request.readyState == 4 && request.status == 200) {
            let response = JSON.parse(request.response);
            let oldsubsite = document.getElementsByClassName("content").item(0);
            if (oldsubsite != null) {
                oldsubsite.remove();
            }
            document.getElementById("stickyHead").insertAdjacentHTML("afterend", response.data);
        }
        else if (request.status != 200) {
            let response = JSON.parse(request.response);
            console.log("HTTP Error " + response.code + "\nMessage: " + response.message);
        }
    };
    let subsiteBody = {
        function: 'switchSite',
        subsite: name
    };
    api.makeCall("post" /* POST */, callback, subsiteBody);
}
function buildCarousel() {
    let api = new Api();
    let callback = (request) => {
        if (request.readyState == 4 && request.status == 200) {
            let response = JSON.parse(request.response);
            /**
             * inserte listItems
             */
            let element = document.getElementsByClassName("carousel-indicators").item(0);
            element.insertAdjacentHTML('afterbegin', response.data.listItems);
            /**
             * insert Carousel
             */
            element = document.getElementById("carousel-frame");
            element.insertAdjacentHTML("beforeend", response.data.carouselItems);
        }
        else if (request.status != 200) {
            let response = JSON.parse(request.response);
            console.log(response.message);
        }
    };
    let carouselBody = {
        function: "buildCarousel"
    };
    api.makeCall("post" /* POST */, callback, carouselBody);
}
function buildSmallProjects() {
    let api = new Api();
    let smallProjectsBody = {
        function: "buildSmallProjects"
    };
    /**
     * can be ignored because the callback will be called with the right variable existing.
     * @ts-ignore  */
    let callback = (request) => {
        let response;
        // @ts-ignore
        if (request.readyState == 4 && request.status == 200) {
            // @ts-ignore
            response = JSON.parse(request.response);
            // @ts-ignore
        }
        else if (request.status != 200) {
            // @ts-ignore
            response = JSON.parse(request.response);
        }
        console.log(response.data);
    };
    api.makeCall("post" /* POST */, callback, smallProjectsBody);
}
var HTTPMethod;
(function (HTTPMethod) {
    HTTPMethod["GET"] = "get";
    HTTPMethod["POST"] = "post";
    HTTPMethod["PUT"] = "put";
    HTTPMethod["DELETE"] = "delete";
    HTTPMethod["PATCH"] = "patch";
    HTTPMethod["OPTION"] = "option";
})(HTTPMethod || (HTTPMethod = {}));
class Api {
    constructor() {
        this.request = new XMLHttpRequest();
    }
    makeCall(method, callback, body) {
        this.request.open(method, Api.PHP_PATH, true);
        this.request.onload = event => callback(this.request);
        if (typeof body !== 'undefined') {
            this.request.send(JSON.stringify(body));
        }
        else {
            this.request.send();
        }
    }
}
Api.PHP_PATH = "Resources/Scripts/PHP/backend.php";

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL1R5cGVzY3JpcHQvYmFja2VuZF9QSFAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsUUFBUSxDQUFDLGdCQUFnQixDQUFDLFlBQVksRUFBRTtBQUN4QyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDVCxRQUFRLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO0lBQy9DLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUNsQixDQUFDLENBQUMsQ0FBQztBQUVILFNBQVMsUUFBUSxDQUFDLFFBQWlCO0lBQy9CLElBQUksUUFBUSxFQUFFO1FBQ1YsUUFBUSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsc0JBQXNCLENBQUMsQ0FBQztRQUN0RixRQUFRLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO1FBQ3BGLFFBQVEsQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLHNCQUFzQixDQUFDLENBQUM7S0FDeEY7SUFFRCxJQUFJLFlBQVksR0FBRyxRQUFRLENBQUMsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFBO0lBQ2hHLElBQUksWUFBWSxJQUFJLFVBQVUsRUFBRTtRQUM1QixjQUFjLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDN0IsYUFBYSxFQUFFLENBQUM7UUFDaEIsa0JBQWtCLEVBQUUsQ0FBQTtLQUN2QjtTQUFNLElBQUksWUFBWSxJQUFJLFFBQVEsRUFBRTtRQUNqQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUE7S0FDL0I7U0FBTSxJQUFJLFlBQVksSUFBSSxTQUFTLEVBQUU7UUFDbEMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFBO0tBQy9CO0FBQ0wsQ0FBQztBQUVELGFBQWE7QUFDYixtREFBbUQ7QUFDbkQsU0FBUyxzQkFBc0IsQ0FBQyxDQUFRO0lBQ3BDLFlBQVk7SUFDWixJQUFJLE9BQU8sR0FBZ0IsQ0FBQyxDQUFDLGFBQWEsQ0FBQztJQUMzQyxJQUFJLFlBQVksR0FBbUIsUUFBUSxDQUFDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLENBQUE7SUFDckYsSUFBSSxZQUFZLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRTtRQUMxQixZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDOUQsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUM7S0FDckQ7SUFDRCxPQUFPLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0lBQ25ELE9BQU8sQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0lBQy9ELEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNqQixDQUFDO0FBRUQsU0FBUyxjQUFjLENBQUMsSUFBWTtJQUNoQyxJQUFJLEdBQUcsR0FBUSxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ3pCLElBQUksUUFBUSxHQUFHLENBQUMsT0FBdUIsRUFBRSxFQUFFO1FBQ3ZDLElBQUksT0FBTyxDQUFDLFVBQVUsSUFBSSxDQUFDLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxHQUFHLEVBQUU7WUFDbEQsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDNUMsSUFBSSxVQUFVLEdBQUcsUUFBUSxDQUFDLHNCQUFzQixDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwRSxJQUFJLFVBQVUsSUFBSSxJQUFJLEVBQUU7Z0JBQ3BCLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQTthQUN0QjtZQUNELFFBQVEsQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUMsa0JBQWtCLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN2RjthQUFNLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxHQUFHLEVBQUU7WUFDOUIsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDNUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEdBQUcsUUFBUSxDQUFDLElBQUksR0FBRyxhQUFhLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ2pGO0lBQ0wsQ0FBQyxDQUFBO0lBS0QsSUFBSSxXQUFXLEdBQVM7UUFDcEIsUUFBUSxFQUFFLFlBQVk7UUFDdEIsT0FBTyxFQUFFLElBQUk7S0FDaEIsQ0FBQztJQUVGLEdBQUcsQ0FBQyxRQUFRLG9CQUFrQixRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDekQsQ0FBQztBQUdELFNBQVMsYUFBYTtJQUNsQixJQUFJLEdBQUcsR0FBUSxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ3pCLElBQUksUUFBUSxHQUFHLENBQUMsT0FBdUIsRUFBRSxFQUFFO1FBQ3ZDLElBQUksT0FBTyxDQUFDLFVBQVUsSUFBSSxDQUFDLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxHQUFHLEVBQUU7WUFDbEQsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDNUM7O2VBRUc7WUFDSCxJQUFJLE9BQU8sR0FBRyxRQUFRLENBQUMsc0JBQXNCLENBQUMscUJBQXFCLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0UsT0FBTyxDQUFDLGtCQUFrQixDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ2xFOztlQUVHO1lBQ0gsT0FBTyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUNwRCxPQUFPLENBQUMsa0JBQWtCLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7U0FDeEU7YUFBTSxJQUFJLE9BQU8sQ0FBQyxNQUFNLElBQUksR0FBRyxFQUFFO1lBQzlCLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzVDLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ2pDO0lBQ0wsQ0FBQyxDQUFBO0lBSUQsSUFBSSxZQUFZLEdBQVM7UUFDckIsUUFBUSxFQUFFLGVBQWU7S0FDNUIsQ0FBQTtJQUNELEdBQUcsQ0FBQyxRQUFRLG9CQUFrQixRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUE7QUFDekQsQ0FBQztBQUVELFNBQVMsa0JBQWtCO0lBQ3ZCLElBQUksR0FBRyxHQUFRLElBQUksR0FBRyxFQUFFLENBQUM7SUFJekIsSUFBSSxpQkFBaUIsR0FBUztRQUMxQixRQUFRLEVBQUUsb0JBQW9CO0tBQ2pDLENBQUE7SUFDRDs7cUJBRWlCO0lBQ2pCLElBQUksUUFBUSxHQUFHLENBQUMsT0FBdUIsRUFBRSxFQUFFO1FBQ3ZDLElBQUksUUFBUSxDQUFBO1FBQ1osYUFBYTtRQUNiLElBQUksT0FBTyxDQUFDLFVBQVUsSUFBSSxDQUFDLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxHQUFHLEVBQUU7WUFDbEQsYUFBYTtZQUNiLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN4QyxhQUFhO1NBQ2hCO2FBQU0sSUFBSSxPQUFPLENBQUMsTUFBTSxJQUFJLEdBQUcsRUFBRTtZQUM5QixhQUFhO1lBQ2IsUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQzNDO1FBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQyxDQUFDO0lBQ0YsR0FBRyxDQUFDLFFBQVEsb0JBQWtCLFFBQVEsRUFBRSxpQkFBaUIsQ0FBQyxDQUFBO0FBQzlELENBQUM7QUFFRCxJQUFXLFVBT1Y7QUFQRCxXQUFXLFVBQVU7SUFDakIseUJBQVcsQ0FBQTtJQUNYLDJCQUFhLENBQUE7SUFDYix5QkFBVyxDQUFBO0lBQ1gsK0JBQWlCLENBQUE7SUFDakIsNkJBQWUsQ0FBQTtJQUNmLCtCQUFpQixDQUFBO0FBQ3JCLENBQUMsRUFQVSxVQUFVLEtBQVYsVUFBVSxRQU9wQjtBQUVELE1BQU0sR0FBRztJQUlMO1FBQ0ksSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO0lBQ3hDLENBQUM7SUFFRCxRQUFRLENBQUMsTUFBa0IsRUFBRSxRQUEwQyxFQUFFLElBQWE7UUFDbEYsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3RELElBQUksT0FBTyxJQUFJLEtBQUssV0FBVyxFQUFFO1lBQzdCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztTQUMzQzthQUFNO1lBQ0gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUN2QjtJQUNMLENBQUM7O0FBZmUsWUFBUSxHQUFHLG1DQUFtQyxDQUFDIiwiZmlsZSI6ImJhY2tlbmRfUEhQLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgZnVuY3Rpb24gKCkge1xufSwgdHJ1ZSk7XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gICAgc3RhcnRQSFAodHJ1ZSlcbn0pO1xuXG5mdW5jdGlvbiBzdGFydFBIUChmaXJzdFJ1bjogYm9vbGVhbikge1xuICAgIGlmIChmaXJzdFJ1bikge1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIlByb2plY3RzXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjaGFuZ2VBY3RpdmVOYXZJdGVtUEhQKTtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJTa2lsbHNcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNoYW5nZUFjdGl2ZU5hdkl0ZW1QSFApO1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIkNvbnRhY3RcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNoYW5nZUFjdGl2ZU5hdkl0ZW1QSFApO1xuICAgIH1cblxuICAgIGxldCBhY3Rpdk5hdkl0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwibmF2LWl0ZW0gYWN0aXZlXCIpWzBdLmNoaWxkcmVuWzBdLnRleHRDb250ZW50XG4gICAgaWYgKGFjdGl2TmF2SXRlbSA9PSBcIlByb2plY3RzXCIpIHtcbiAgICAgICAgbG9hZHN1YlNpdGVwaHAoYWN0aXZOYXZJdGVtKTtcbiAgICAgICAgYnVpbGRDYXJvdXNlbCgpO1xuICAgICAgICBidWlsZFNtYWxsUHJvamVjdHMoKVxuICAgIH0gZWxzZSBpZiAoYWN0aXZOYXZJdGVtID09IFwiU2tpbGxzXCIpIHtcbiAgICAgICAgbG9hZHN1YlNpdGVwaHAoYWN0aXZOYXZJdGVtKVxuICAgIH0gZWxzZSBpZiAoYWN0aXZOYXZJdGVtID09IFwiQ29udGFjdFwiKSB7XG4gICAgICAgIGxvYWRzdWJTaXRlcGhwKGFjdGl2TmF2SXRlbSlcbiAgICB9XG59XG5cbi8vIEB0cy1pZ25vcmVcbi8qKiBDaGFuZ2VzIHRoZSBhY3RpdmUgTmF2SXRlbSB0byB0aGUgY2xpY2tlZCBvbmUqL1xuZnVuY3Rpb24gY2hhbmdlQWN0aXZlTmF2SXRlbVBIUChlOiBFdmVudCkge1xuICAgIC8vQHRzLWlnbm9yZVxuICAgIGxldCBuYXZJdGVtOiBIVE1MRWxlbWVudCA9IGUuY3VycmVudFRhcmdldDtcbiAgICBsZXQgYWN0aXZOYXZJdGVtOiBIVE1MQ29sbGVjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJuYXYtaXRlbSBhY3RpdmVcIilcbiAgICBpZiAoYWN0aXZOYXZJdGVtLmxlbmd0aCA8PSAxKSB7XG4gICAgICAgIGFjdGl2TmF2SXRlbVswXS5jaGlsZHJlblswXS5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm5hdi1saW5rXCIpO1xuICAgICAgICBhY3Rpdk5hdkl0ZW1bMF0uc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJuYXYtaXRlbVwiKTtcbiAgICB9XG4gICAgbmF2SXRlbS5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm5hdi1saW5rIGRpc2FibGVkXCIpO1xuICAgIG5hdkl0ZW0ucGFyZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm5hdi1pdGVtIGFjdGl2ZVwiKTtcbiAgICBzdGFydChmYWxzZSk7XG59XG5cbmZ1bmN0aW9uIGxvYWRzdWJTaXRlcGhwKG5hbWU6IFN0cmluZykge1xuICAgIGxldCBhcGk6IEFwaSA9IG5ldyBBcGkoKTtcbiAgICBsZXQgY2FsbGJhY2sgPSAocmVxdWVzdDogWE1MSHR0cFJlcXVlc3QpID0+IHtcbiAgICAgICAgaWYgKHJlcXVlc3QucmVhZHlTdGF0ZSA9PSA0ICYmIHJlcXVlc3Quc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgbGV0IHJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXF1ZXN0LnJlc3BvbnNlKTtcbiAgICAgICAgICAgIGxldCBvbGRzdWJzaXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImNvbnRlbnRcIikuaXRlbSgwKTtcbiAgICAgICAgICAgIGlmIChvbGRzdWJzaXRlICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBvbGRzdWJzaXRlLnJlbW92ZSgpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0aWNreUhlYWRcIikuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYWZ0ZXJlbmRcIiwgcmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0gZWxzZSBpZiAocmVxdWVzdC5zdGF0dXMgIT0gMjAwKSB7XG4gICAgICAgICAgICBsZXQgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2UpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJIVFRQIEVycm9yIFwiICsgcmVzcG9uc2UuY29kZSArIFwiXFxuTWVzc2FnZTogXCIgKyByZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0eXBlIGJvZHkgPSB7XG4gICAgICAgIGZ1bmN0aW9uOiBTdHJpbmdcbiAgICAgICAgc3Vic2l0ZTogU3RyaW5nXG4gICAgfTtcbiAgICBsZXQgc3Vic2l0ZUJvZHk6IGJvZHkgPSB7XG4gICAgICAgIGZ1bmN0aW9uOiAnc3dpdGNoU2l0ZScsXG4gICAgICAgIHN1YnNpdGU6IG5hbWVcbiAgICB9O1xuXG4gICAgYXBpLm1ha2VDYWxsKEhUVFBNZXRob2QuUE9TVCwgY2FsbGJhY2ssIHN1YnNpdGVCb2R5KTtcbn1cblxuXG5mdW5jdGlvbiBidWlsZENhcm91c2VsKCkge1xuICAgIGxldCBhcGk6IEFwaSA9IG5ldyBBcGkoKTtcbiAgICBsZXQgY2FsbGJhY2sgPSAocmVxdWVzdDogWE1MSHR0cFJlcXVlc3QpID0+IHtcbiAgICAgICAgaWYgKHJlcXVlc3QucmVhZHlTdGF0ZSA9PSA0ICYmIHJlcXVlc3Quc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgbGV0IHJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXF1ZXN0LnJlc3BvbnNlKTtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogaW5zZXJ0ZSBsaXN0SXRlbXNcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgbGV0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiY2Fyb3VzZWwtaW5kaWNhdG9yc1wiKS5pdGVtKDApO1xuICAgICAgICAgICAgZWxlbWVudC5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCByZXNwb25zZS5kYXRhLmxpc3RJdGVtcyk7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIGluc2VydCBDYXJvdXNlbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjYXJvdXNlbC1mcmFtZVwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYmVmb3JlZW5kXCIsIHJlc3BvbnNlLmRhdGEuY2Fyb3VzZWxJdGVtcyk7XG4gICAgICAgIH0gZWxzZSBpZiAocmVxdWVzdC5zdGF0dXMgIT0gMjAwKSB7XG4gICAgICAgICAgICBsZXQgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2UpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdHlwZSBib2R5ID0ge1xuICAgICAgICBmdW5jdGlvbjogU3RyaW5nXG4gICAgfTtcbiAgICBsZXQgY2Fyb3VzZWxCb2R5OiBib2R5ID0ge1xuICAgICAgICBmdW5jdGlvbjogXCJidWlsZENhcm91c2VsXCJcbiAgICB9XG4gICAgYXBpLm1ha2VDYWxsKEhUVFBNZXRob2QuUE9TVCwgY2FsbGJhY2ssIGNhcm91c2VsQm9keSlcbn1cblxuZnVuY3Rpb24gYnVpbGRTbWFsbFByb2plY3RzKCkge1xuICAgIGxldCBhcGk6IEFwaSA9IG5ldyBBcGkoKTtcbiAgICB0eXBlIGJvZHkgPSB7XG4gICAgICAgIGZ1bmN0aW9uOiBTdHJpbmdcbiAgICB9O1xuICAgIGxldCBzbWFsbFByb2plY3RzQm9keTogYm9keSA9IHtcbiAgICAgICAgZnVuY3Rpb246IFwiYnVpbGRTbWFsbFByb2plY3RzXCJcbiAgICB9XG4gICAgLyoqXG4gICAgICogY2FuIGJlIGlnbm9yZWQgYmVjYXVzZSB0aGUgY2FsbGJhY2sgd2lsbCBiZSBjYWxsZWQgd2l0aCB0aGUgcmlnaHQgdmFyaWFibGUgZXhpc3RpbmcuXG4gICAgICogQHRzLWlnbm9yZSAgKi9cbiAgICBsZXQgY2FsbGJhY2sgPSAocmVxdWVzdDogWE1MSHR0cFJlcXVlc3QpID0+IHtcbiAgICAgICAgbGV0IHJlc3BvbnNlXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgaWYgKHJlcXVlc3QucmVhZHlTdGF0ZSA9PSA0ICYmIHJlcXVlc3Quc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2UpO1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB9IGVsc2UgaWYgKHJlcXVlc3Quc3RhdHVzICE9IDIwMCkge1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpO1xuICAgIH07XG4gICAgYXBpLm1ha2VDYWxsKEhUVFBNZXRob2QuUE9TVCwgY2FsbGJhY2ssIHNtYWxsUHJvamVjdHNCb2R5KVxufVxuXG5jb25zdCBlbnVtIEhUVFBNZXRob2Qge1xuICAgIEdFVCA9ICdnZXQnLFxuICAgIFBPU1QgPSAncG9zdCcsXG4gICAgUFVUID0gJ3B1dCcsXG4gICAgREVMRVRFID0gJ2RlbGV0ZScsXG4gICAgUEFUQ0ggPSAncGF0Y2gnLFxuICAgIE9QVElPTiA9ICdvcHRpb24nLFxufVxuXG5jbGFzcyBBcGkge1xuICAgIHN0YXRpYyByZWFkb25seSBQSFBfUEFUSCA9IFwiUmVzb3VyY2VzL1NjcmlwdHMvUEhQL2JhY2tlbmQucGhwXCI7XG4gICAgcHVibGljIHJlYWRvbmx5IHJlcXVlc3Q6IFhNTEh0dHBSZXF1ZXN0O1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIH1cblxuICAgIG1ha2VDYWxsKG1ldGhvZDogSFRUUE1ldGhvZCwgY2FsbGJhY2s6IChyZXF1ZXN0OiBYTUxIdHRwUmVxdWVzdCkgPT4gYW55LCBib2R5Pzogb2JqZWN0KTogdm9pZCB7XG4gICAgICAgIHRoaXMucmVxdWVzdC5vcGVuKG1ldGhvZCwgQXBpLlBIUF9QQVRILCB0cnVlKTtcbiAgICAgICAgdGhpcy5yZXF1ZXN0Lm9ubG9hZCA9IGV2ZW50ID0+IGNhbGxiYWNrKHRoaXMucmVxdWVzdCk7XG4gICAgICAgIGlmICh0eXBlb2YgYm9keSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMucmVxdWVzdC5zZW5kKEpTT04uc3RyaW5naWZ5KGJvZHkpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVxdWVzdC5zZW5kKCk7XG4gICAgICAgIH1cbiAgICB9XG59Il19
